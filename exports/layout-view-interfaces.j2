
{%- set ports = 73 %}
{%- set switch = queryset[0].device.device_type|replace(' ', '-') %}
<!DOCTYPE html>
<html lang="en" data-netbox-color-mode="dark">
<head>
    <title>{{queryset[0].device.name}} Layout</title>
    <link rel="stylesheet" href="/static/netbox-external.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-external.css'">
    <link rel="stylesheet" href="/static/netbox-light.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-light.css'">
    <link rel="stylesheet" href="/static/netbox-dark.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-dark.css'">
    <link rel="icon" type="image/png" href="/static/netbox.ico">
    <link rel="apple-touch-icon" type="image/png" href="/static/netbox_touch-icon-180.png">
    <style>
        html {
            width: max-content;
            --row-height: 110px;
            --column-width: 170px;
            --port-active: rgb(49, 58, 64);
            --bg-col: rgb(27, 31, 34);
            --port-inactive: rgb(36, 40, 43);
            --text-primary: rgb(255, 255, 255);
            --text-secondary: rgba(255, 255, 255, 0.25);
            --weight: normal;
            --disabled: rgb(57, 29, 29);
            --disabled-text: rgb(106, 85, 85);
            --vision: rgb(42, 83, 44);
            --comms: rgb(68, 82, 83);
            --wifi: rgb(43, 70, 46);
            --router-panel: rgb(52, 93, 54);
            --omneo-1013: rgb(76, 66, 98);
            --omneo-1021: rgb(35, 88, 108);
            --omneo-1022: rgb(72, 95, 130);
        }

        html[data-netbox-color-mode="light"] {
            --row-height: 110px;
            --column-width: 170px;
            --port-active: rgb(219, 219, 219);
            --bg-col: rgb(255, 255, 255);
            --port-inactive: rgb(241, 241, 241);
            --text-primary: rgb(0, 0, 0);
            --text-secondary: rgba(0, 0, 0, 0.25);
            --weight: bold;
            --disabled: rgb(249, 201, 201);
            --disabled-text: rgb(106, 85, 85);
            --vision: rgb(87, 177, 90);
            --comms: rgb(158, 158, 158);
            --wifi: rgb(157, 251, 167);
            --router-panel: rgb(127, 223, 131);
            --omneo-1013: rgb(194, 167, 254);
            --omneo-1021: rgb(140, 223, 255);
            --omneo-1022: rgb(141, 186, 255);
        }

        body {
            padding: 0 10px;
            width: max-content;
            background-color: var(--bg-col) !important;
        }

        main {
            display: grid;
            grid-gap: 10px;
        }

        header {
            font-size: 24pt;
            margin: 10px 0px;
            color: var(--text-primary);
            font-weight: var(--weight);
            display: flex;
            align-items: center;
        }
        a.badge.link {
            font-size: 1rem;
        }
        .logo {
            height: 2em;
            margin-right: 10px;
        }
        .logo-dark {
            display: none;
        }

        .logo-light {
            display: block;
        }

        html[data-netbox-color-mode="dark"] .logo-dark {
            display: block;
        }

        html[data-netbox-color-mode="dark"] .logo-light {
            display: none;
        }

        .manage-link {
            font-size: 0.6em;
        }
        .manage-link a {
            text-decoration: none !important;
        }

        .to-cont {
          color: var(--text-primary);
          font-weight: var(--weight);
        }
        .to-device, .to-port {
            font-weight: normal;
            font-size: 0.9em;
        }
        .from-name,
        .from-label,
        .from-type,
        .from-cont,
        .port-mode,
        .to-label,
        .to-type {
           display: none;
        }
        .switchport {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: var(--port-active);
            border-radius: 10px;
            padding: 10px;
            z-index: 1;
        }
        .switchport > a {
            position: absolute;
            inset: 0;
            text-decoration: none !important;
        }
        .port-label {
            position: absolute;
            left: 50%;
            translate: -50% 0%;
            font-weight: bold;
            font-size: 34pt;
            color: var(--text-secondary);
            height: max-content;
            text-align: center;
            bottom: 0px;
            white-space: nowrap;
        }
        .empty {
            background-color: var(--port-inactive);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            font-size: 14pt;
            color: rgb(91, 94, 96);
            font-weight: bold;
        }
        .empty-text {
            height: 3em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .Fibre .port-label::after,
        [data-mode="1000base-x-sfp"] .port-label::after {
            content: " (SFP)";
        }
        [data-mode="10gbase-x-sfpp"] .port-label::after {
            content: " (SFP+)";
        }

        [data-mode="1000base-x-sfp"] .port-label,
        [data-mode="10gbase-x-sfpp"] .port-label {
            font-size: 20pt !important;
        }
        .disabled {
            background-color: var(--disabled);
            color: var(--disabled-text);
        }

        .blank {grid-area: blank;}

        {%- if switch == 'Catalyst-3850-48T' %}
        {%- set ports = 49 %}
        main {
            grid-template-areas: "gi1 gi3 gi5 gi7 gi9 gi11 gi13 gi15 gi17 gi19 gi21 gi23 gi25 gi27 gi29 gi31 gi33 gi35 gi37 gi39 gi41 gi43 gi45 gi47 blank blank blank blank" "gi2 gi4 gi6 gi8 gi10 gi12 gi14 gi16 gi18 gi20 gi22 gi24 gi26 gi28 gi30 gi32 gi34 gi36 gi38 gi40 gi42 gi44 gi46 gi48 gi1-1 gi1-2 gi1-3 gi1-4";
            grid-template-columns: repeat(28, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'ProSafe-M4300-52G-PoE' %}
        {%- set ports = 53 %}
        main {
            grid-template-areas: "gi1 gi3 gi5 gi7 gi9 gi11 gi13 gi15 gi17 gi19 gi21 gi23 gi25 gi27 gi29 gi31 gi33 gi35 gi37 gi39 gi41 gi43 gi45 gi47 gi49 gi51" "gi2 gi4 gi6 gi8 gi10 gi12 gi14 gi16 gi18 gi20 gi22 gi24 gi26 gi28 gi30 gi32 gi34 gi36 gi38 gi40 gi42 gi44 gi46 gi48 gi50 gi52";
            grid-template-columns: repeat(26, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'EX4300-48' %}
        {%- set ports = 49 %}
        main {
            grid-template-areas: "gi0 gi2 gi4 gi6 gi8 gi10 gi12 gi14 gi16 gi18 gi20 gi22 gi24 gi26 gi28 gi30 gi32 gi34 gi36 gi38 gi40 gi42 gi44 gi46 blank blank blank blank" "gi1 gi3 gi5 gi7 gi9 gi11 gi13 gi15 gi17 gi19 gi21 gi23 gi25 gi27 gi29 gi31 gi33 gi35 gi37 gi39 gi41 gi43 gi45 gi47 gi1-0 gi1-1 gi1-2 gi1-3";
            grid-template-columns: repeat(28, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'Nexus-93180YC-FX3' %}
        {%- set ports = 73 %}
        main {
            grid-template-areas: "gi1 gi3 gi5 gi7 gi9 gi11 gi13 gi15 gi17 gi19 gi21 gi23 gi25 gi27 gi29 gi31 gi33 gi35 gi37 gi39 gi41 gi43 gi45 gi47 qgi1-1 qgi1-2 qgi1-3 qgi1-4 qgi3-1 qgi3-2 qgi3-3 qgi3-4 qgi5-1 qgi5-2 qgi5-3 qgi5-4" "gi2 gi4 gi6 gi8 gi10 gi12 gi14 gi16 gi18 gi20 gi22 gi24 gi26 gi28 gi30 gi32 gi34 gi36 gi38 gi40 gi42 gi44 gi46 gi48 qgi2-1 qgi2-2 qgi2-3 qgi2-4 qgi4-1 qgi4-2 qgi4-3 qgi4-4 qgi6-1 qgi6-2 qgi6-3 qgi6-4";
            grid-template-columns: repeat(36, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }
        .gi2-6-1 {grid-area: qgi6-1 / qgi6-1 / qgi6-1 / qgi6-4 !important;}
        .qsfp {
            background: var(--port-inactive);
            border-radius: 14px;
            margin: -4px;
            border: 2px solid rgb(101, 105, 110);
        }

        {%- elif switch == 'SG300-10P' %}
        {%- set ports = 11 %}
        main {
            grid-template-areas: "gi1 gi2 gi3 gi4 gi5 gi6 gi7 gi8 gi9 gi9f gi10 gi10f";
            grid-template-columns: repeat(12, var(--column-width));
            grid-template-rows: repeat(1, var(--row-height));
        }

        {%- elif switch == 'SG220-26P' %}
        {%- set ports = 27 %}
        main {
            grid-template-areas: "gi1 gi2 gi3 gi4 gi5 gi6 gi7 gi8 gi9 gi10 gi11 gi12 gi25 gi25f" "gi13 gi14 gi15 gi16 gi17 gi18 gi19 gi20 gi21 gi22 gi23 gi24 gi26 gi26f";
            grid-template-columns: repeat(14, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }
        {% endif %}

        {% for i in range(ports) %}
            .gi{{i}} {
                grid-area:gi{{i}};
            }
            .gi{{i}}.Fibre {
                grid-area:gi{{i}}f;
            }
            .gi1-0-{{i}} {
                grid-area:gi{{i}};
            }
            .gi1-{{i}} {
                grid-area: gi{{i}};
            }
            .gi0-{{i}} {
                grid-area: gi{{i}};
            }
        {% endfor %}

        {% for i in range(6) %}
            .gi1-1-{{i}} {
                grid-area:gi1-{{i}};
            }
            .qsfp-{{i+1}} {
                grid-area: qgi{{i+1}}-1 / qgi{{i+1}}-1 / qgi{{i+1}}-1 / qgi{{i+1}}-4;
            }
            .e1-{{i}} {
                grid-area: gi1-{{i}}
            }
            {% for lane in range(4) %}
                .gi2-{{i+1}}-{{lane+1}} {
                    grid-area: qgi{{i+1}}-{{lane+1}};
                }
            {% endfor %}
        {% endfor %}

        .Vision {
            background-color: var(--vision);
        }
        .Comms {
            background-color: var(--comms)
        }
        .WiFi {
            background-color: var(--wifi)
        }
        .Router-Panel {
            background-color: var(--router-panel)
        }
        .Omneo-1013 {
            background-color: var(--omneo-1013)
        }
        .Omneo-1021 {
            background-color: var(--omneo-1021)
        }
        .Omneo-1022 {
            background-color: var(--omneo-1022)
        }
        @media print {
            html[data-netbox-color-mode="light"],
            html[data-netbox-color-mode="dark"] {
                font-size: 18pt;
                --row-height: 180px;
                --column-width: 190px;
                --port-active: rgb(219, 219, 219);
                --bg-col: rgb(255, 255, 255);
                --port-inactive: rgb(241, 241, 241);
                --text-primary: rgb(0, 0, 0);
                --text-secondary: rgba(0, 0, 0, 0.25);
                --weight: bold;
                --disabled: rgb(249, 201, 201);
                --disabled-text: rgb(106, 85, 85);
                --vision: rgb(87, 177, 90);
                --comms: rgb(158, 158, 158);
                --wifi: rgb(157, 251, 167);
                --router-panel: rgb(127, 223, 131);
                --omneo-1013: rgb(194, 167, 254);
                --omneo-1021: rgb(140, 223, 255);
                --omneo-1022: rgb(141, 186, 255);
            }
            .switchport {
                border: 1px solid rgb(191, 191, 191);
            }

            .logo-dark {
                display: none !important;
            }

            .logo-light {
                display: block !important;
            }

            a {
                text-decoration: none !important;
                color: black !important;
            }
            .manage-link {
                display: none;
            }
        }
        .Switch .link-normal {
            display: contents;
        }
        .link-switch {
            display: contents;
        }
        .Switch .link-switch {
            display: block;
        }
        .link-switch,
        .link-normal {
            z-index: 1;
        }
    </style>
    <script type="text/javascript" src="/static/setmode.js" onerror="window.location='/media-failure/?filename=setmode.js'"></script>
    <script>initMode()</script>
</head>
<body>
    <header>
        <a href="/">
            <img src="/static/nep_logo.svg" class="sidenav-brand-img logo-light logo" alt="NetBox Logo" height="48">
            <img src="/static/nep_logo_light.svg" class="sidenav-brand-img logo-dark logo" alt="NetBox Logo" height="48">
        </a>
        <a href="/dcim/devices/{{queryset[0].device.id}}">{{queryset[0].device.name}} </a>
        <span>&nbsp;Layout -&nbsp;</span>
        <a href="/dcim/device-types/{{queryset[0].device.device_type.id}}"> {{queryset[0].device.device_type}}</a>
        {% if queryset[0].device.primary_ip4 %}
            {% set ip = queryset[0].device.primary_ip4|ip() %}
            <span class="manage-link">
                <a class="badge bg-green ms-4 link" href="ssh://{{ip}}"><i class="mdi mdi-monitor-lock"></i> SSH <i class="mdi mdi-open-in-new" style="margin-left:0.2em"></i></a>
                <a class="badge bg-green ms-2 link" href="http://{{ip}}" target="_blank"><i class="mdi mdi-cloud-lock"></i> HTTP <i class="mdi mdi-open-in-new" style="margin-left:0.2em"></i></a>
                <a class="badge bg-blue ms-2 link" href="/dcim/devices/{{queryset[0].device.id}}/render-config/?export=True" target="_blank"><i class="mdi mdi-download"></i> Config</a>
            </span>
        {% endif %}
    </header>
    <main class="{{switch}}">
        {% for interface in queryset %}
            {% set label = interface.label|replace('/','-')|replace('gi','')|replace('Ethernet', '')|replace('ge-0-0-', '1-0-')|replace('xe-0-2-', '1-1-') %}
            {% set name = interface.name|replace('(','')|replace(')','') %}
            {% set vlan = 'vlan_' ~ interface.untagged_vlan.vid %}
            {% if interface.mgmt_only == false and interface.is_lag == false and interface.type != "juniper-vcp" %}
                {% if interface.link_peers %}
                    {% set from = interface.link_peers|first %}
                    <section class="switchport {{vlan}} {% for tag in from.device.tags.names() %}{{tag|replace(' ','-') }} {% endfor %}gi{{label}} {{name}}"
                        data-mode="{{interface.type}}"
                        data-cable="{{interface.cable.color}}">
                        <a class="link-normal" href="/dcim/devices/{{ from.device.id}}" target="_blank"></a>
                        <a class="link-switch" href="/dcim/interfaces/?device_id={{from.device.id}}&export=interface-layouts"></a>
                        <div class="from-cont">
                            <div class="from-name">{{ interface.device}}</div>
                            <div class="from-port">{{ interface.name}}</div>
                            <div class="from-label">{{ interface.label}}</div>
                            <div class="from-type">{{ interface.type}}</div>
                        </div>
                        <div class="to-cont">
                            <div class="to-name">{{ from.device.name}}</div>
                            <div class="to-device">{{ from.device.device_type}}</div>
                            <div class="to-port">{{ from.name}}</div>
                            <div class="to-label">{{ from.label}}</div>
                            <div class="to-type">{{ from.type}}</div>
                        </div>
                        <div class="port-mode">{{ interface.type }}</div>
                        <div class="port-label">{{label}}</div>
                    </section>
                {% else %}
                    <section class="empty {{vlan}} gi{{label}} {{name}} {% if interface.enabled == false %}disabled{% endif %}" data-mode="{{interface.type}}">
                        <div class="empty-text">
                            {% if interface.enabled == false %}
                                Disabled
                            {% else %}
                                Empty
                            {% endif %}
                            {% if interface.mode == 'access' %}
                                <div class="empty-mode">{{interface.untagged_vlan}}</div>
                            {% elif interface.mode == 'tagged' %}
                                <div class="empty-mode">Trunk</div>
                            {% endif %}
                        </div>
                        <div class="port-label">{{label}}</div>
                    </section>
                {% endif %}
            {% endif %}
        {% endfor %}
        {% for qsfp in range(6) %}
            <div class="qsfp-{{qsfp+1}} qsfp"></div>
        {% endfor %}
        <div class="blank"></div><div class="blank2"></div>
    </main>
</body>
</html>