
{%- set ports1 = 73 %}
{%- set ports2 = 6 %}
{%- set prefix1 = "gi" %}
{%- set prefix2 = "te" %}
{%- set offset = 0 %}
{%- set lanes = 0 %}
{%- set switch = queryset[0].device.device_type|replace(' ', '-') %}
<!DOCTYPE html>
<html lang="en" data-netbox-color-mode="dark">
<head>
    <title>{{queryset[0].device.name}} Layout</title>
    <link rel="stylesheet" href="/static/netbox-external.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-external.css'">
    <link rel="stylesheet" href="/static/netbox-light.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-light.css'">
    <link rel="stylesheet" href="/static/netbox-dark.css?v=3.4.4" onerror="window.location='/media-failure/?filename=netbox-dark.css'">
    <link rel="icon" type="image/png" href="/static/netbox.ico">
    <link rel="apple-touch-icon" type="image/png" href="/static/netbox_touch-icon-180.png">
    <style>
        html {
            width: max-content;
            --row-height: 110px;
            --column-width: 170px;
            --port-active: rgb(49, 58, 64);
            --bg-col: rgb(27, 31, 34);
            --port-inactive: rgb(36, 40, 43);
            --text-primary: rgb(255, 255, 255);
            --text-secondary: rgba(255, 255, 255, 0.25);
            --weight: normal;
            --disabled: rgb(57, 29, 29);
            --disabled-text: rgb(106, 85, 85);
            --vision: rgb(42, 83, 44);
            --comms: rgb(68, 82, 83);
            --wifi: rgb(43, 70, 46);
            --router-panel: rgb(52, 93, 54);
            --omneo-1013: rgb(76, 66, 98);
            --omneo-1021: rgb(35, 88, 108);
            --omneo-1022: rgb(72, 95, 130);
        }

        html[data-netbox-color-mode="light"] {
            --row-height: 110px;
            --column-width: 170px;
            --port-active: rgb(219, 219, 219);
            --bg-col: rgb(255, 255, 255);
            --port-inactive: rgb(241, 241, 241);
            --text-primary: rgb(0, 0, 0);
            --text-secondary: rgba(0, 0, 0, 0.25);
            --weight: bold;
            --disabled: rgb(249, 201, 201);
            --disabled-text: rgb(106, 85, 85);
            --vision: rgb(87, 177, 90);
            --comms: rgb(158, 158, 158);
            --wifi: rgb(157, 251, 167);
            --router-panel: rgb(127, 223, 131);
            --omneo-1013: rgb(194, 167, 254);
            --omneo-1021: rgb(140, 223, 255);
            --omneo-1022: rgb(141, 186, 255);
        }

        body {
            padding: 0 10px;
            width: max-content;
            background-color: var(--bg-col) !important;
        }

        main {
            display: grid;
            grid-gap: 10px;
        }

        header {
            font-size: 24pt;
            margin: 10px 0px;
            color: var(--text-primary);
            font-weight: var(--weight);
            display: flex;
            align-items: center;
        }
        a.badge.link {
            font-size: 1rem;
        }
        .logo {
            height: 2em;
            margin-right: 10px;
        }
        .logo-dark {
            display: none;
        }

        .logo-light {
            display: block;
        }

        html[data-netbox-color-mode="dark"] .logo-dark {
            display: block;
        }

        html[data-netbox-color-mode="dark"] .logo-light {
            display: none;
        }

        .manage-link {
            font-size: 0.6em;
        }
        .manage-link a {
            text-decoration: none !important;
        }

        .to-cont {
          color: var(--text-primary);
          font-weight: var(--weight);
        }
        .to-device, .to-port {
            font-weight: normal;
            font-size: 0.9em;
        }
        .from-name,
        .from-label,
        .from-type,
        .from-cont,
        .port-mode,
        .to-label,
        .to-type {
           display: none;
        }
        .switchport {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: var(--port-active);
            border-radius: 10px;
            padding: 10px;
            z-index: 1;
        }
        .switchport > a {
            position: absolute;
            inset: 0;
            text-decoration: none !important;
        }
        .port-label {
            position: absolute;
            left: 50%;
            translate: -50% 0%;
            font-weight: bold;
            font-size: 34pt;
            color: var(--text-secondary);
            height: max-content;
            text-align: center;
            bottom: 0px;
            white-space: nowrap;
        }
        .empty {
            background-color: var(--port-inactive);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            font-size: 14pt;
            color: rgb(91, 94, 96);
            font-weight: bold;
        }
        .empty-text {
            height: 3em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .Fibre .port-label::after,
        [data-mode="1000base-x-sfp"] .port-label::after {
            content: " (SFP)";
        }
        [data-mode="10gbase-x-sfpp"] .port-label::after {
            content: " (SFP+)";
        }

        [data-mode="1000base-x-sfp"] .port-label,
        [data-mode="10gbase-x-sfpp"] .port-label {
            font-size: 20pt !important;
        }
        .disabled {
            background-color: var(--disabled);
            color: var(--disabled-text);
        }
        .qsfp {
            background: var(--port-inactive);
            border-radius: 14px;
            margin: -4px;
            border: 2px solid rgb(101, 105, 110);
        }
        .blank {grid-area: blank;}

        {%- if switch == 'Catalyst-3850-48T' %}
            {%- set ports1 = 48 %}
            {%- set ports2 = 4 %}
            {%- set prefix1 = "gi1-0-" %}
            {%- set prefix2 = "gi1-1-" %}
        main {
            grid-template-areas: "e1 e3 e5 e7 e9 e11 e13 e15 e17 e19 e21 e23 e25 e27 e29 e31 e33 e35 e37 e39 e41 e43 e45 e47 blank blank blank blank" "e2 e4 e6 e8 e10 e12 e14 e16 e18 e20 e22 e24 e26 e28 e30 e32 e34 e36 e38 e40 e42 e44 e46 e48 f1 f2 f3 f4";
            grid-template-columns: repeat(28, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'ProSafe-M4300-52G-PoE' %}
        {%- set ports1 = 53 %}
        main {
            grid-template-areas: "e1 e3 e5 e7 e9 e11 e13 e15 e17 e19 e21 e23 e25 e27 e29 e31 e33 e35 e37 e39 e41 e43 e45 e47 e49 e51" "e2 e4 e6 e8 e10 e12 e14 e16 e18 e20 e22 e24 e26 e28 e30 e32 e34 e36 e38 e40 e42 e44 e46 e48 e50 e52";
            grid-template-columns: repeat(26, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'EX4300-48' %}
            {%- set ports1 = 48 %}
            {%- set ports2 = 4 %}
            {%- set prefix1 = "ge-0-0-" %}
            {%- set prefix2 = "xe-0-2-" %}
        main {
            grid-template-areas: "e0 e2 e4 e6 e8 e10 e12 e14 e16 e18 e20 e22 e24 e26 e28 e30 e32 e34 e36 e38 e40 e42 e44 e46 blank blank blank blank" "e1 e3 e5 e7 e9 e11 e13 e15 e17 e19 e21 e23 e25 e27 e29 e31 e33 e35 e37 e39 e41 e43 e45 e47 f1 f2 f3 f4";
            grid-template-columns: repeat(28, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }

        {%- elif switch == 'Nexus-93180YC-FX3' %}
            {%- set ports1 = 48 %}
            {%- set ports2 = 6 %}
            {%- set prefix1 = "Ethernet1-" %}
            {%- set prefix2 = "Ethernet1-" %}
            {%- set offset = 48 %}
            {%- set lanes = 4 %}
        main {
            grid-template-areas: "e1 e3 e5 e7 e9 e11 e13 e15 e17 e19 e21 e23 e25 e27 e29 e31 e33 e35 e37 e39 e41 e43 e45 e47 q49-1 q49-2 q49-3 q49-4 q51-1 q51-2 q51-3 q51-4 q53-1 q53-2 q53-3 q53-4" "e2 e4 e6 e8 e10 e12 e14 e16 e18 e20 e22 e24 e26 e28 e30 e32 e34 e36 e38 e40 e42 e44 e46 e48 q50-1 q50-2 q50-3 q50-4 q52-1 q52-2 q52-3 q52-4 q54-1 q54-2 q54-3 q54-4";
            grid-template-columns: repeat(36, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }
        .port_{{prefix2}}53-1 {grid-area: q53-1 / q53-1 / q53-1 / q53-4 !important;}
        .port_{{prefix2}}54-1 {grid-area: q54-1 / q54-1 / q54-1 / q54-4 !important;}
        {%- elif switch == 'SG300-10P' or switch == 'SG300-10P' %}
        {%- set ports1 = 11 %}
        main {
            grid-template-areas: "e1 e2 e3 e4 e5 e6 e7 e8 e9 f9 e10 f10";
            grid-template-columns: repeat(12, var(--column-width));
            grid-template-rows: repeat(1, var(--row-height));
        }

        {%- elif switch == 'SG220-26P' or switch == 'SG220-26' %}
        {%- set ports1 = 27 %}
        main {
            grid-template-areas: "e1 e2 e3 e4 e5 e6 e7 e8 e9 e10 e11 e12 e25 f25" "e13 e14 e15 e16 e17 e18 e19 e20 e21 e22 e23 e24 e26 f26";
            grid-template-columns: repeat(14, var(--column-width));
            grid-template-rows: repeat(2, var(--row-height));
        }
        {% endif %}

        {% for i in range(ports1+1) %}
            .port_{{prefix1}}{{i}} {
                grid-area:e{{i}};
            }
            .port_{{prefix1}}{{i}}.Fibre {
                grid-area:f{{i}};
            }
        {% endfor %}

        {% for i in range(ports2+1) %}
            {% if lanes > 0 %}
                {% for lane in range(lanes) %}
                    .port_{{prefix2}}{{i+offset+1}}-{{lane+1}} {
                        grid-area: q{{i+offset+1}}-{{lane+1}};
                    }
                {% endfor %}
                .qsfp-{{i+1}} {
                    grid-area: q{{i+offset+1}}-1 / q{{i+offset+1}}-1 / q{{i+offset+1}}-1 / q{{i+offset+1}}-4;
                }
            {% else %}
                .port_{{prefix2}}{{i}} {
                    grid-area: f{{i}};
                }
            {% endif %}
        {% endfor %}

        .Vision {
            background-color: var(--vision);
        }
        .Comms {
            background-color: var(--comms)
        }
        .WiFi {
            background-color: var(--wifi)
        }
        .Router-Panel {
            background-color: var(--router-panel)
        }
        .Omneo-1013 {
            background-color: var(--omneo-1013)
        }
        .Omneo-1021 {
            background-color: var(--omneo-1021)
        }
        .Omneo-1022 {
            background-color: var(--omneo-1022)
        }
        @media print {
            html[data-netbox-color-mode="light"],
            html[data-netbox-color-mode="dark"] {
                font-size: 18pt;
                --row-height: 180px;
                --column-width: 190px;
                --port-active: rgb(219, 219, 219);
                --bg-col: rgb(255, 255, 255);
                --port-inactive: rgb(241, 241, 241);
                --text-primary: rgb(0, 0, 0);
                --text-secondary: rgba(0, 0, 0, 0.25);
                --weight: bold;
                --disabled: rgb(249, 201, 201);
                --disabled-text: rgb(106, 85, 85);
                --vision: rgb(87, 177, 90);
                --comms: rgb(158, 158, 158);
                --wifi: rgb(157, 251, 167);
                --router-panel: rgb(127, 223, 131);
                --omneo-1013: rgb(194, 167, 254);
                --omneo-1021: rgb(140, 223, 255);
                --omneo-1022: rgb(141, 186, 255);
            }
            .switchport {
                border: 1px solid rgb(191, 191, 191);
            }

            .logo-dark {
                display: none !important;
            }

            .logo-light {
                display: block !important;
            }

            a {
                text-decoration: none !important;
                color: black !important;
            }
            .manage-link {
                display: none;
            }
        }
        .Switch .link-normal {
            display: contents;
        }
        .link-switch {
            display: contents;
        }
        .Switch .link-switch {
            display: block;
        }
        .link-switch,
        .link-normal {
            z-index: 1;
        }
        .show-types [data-type="mmf-om4"] {
            background-color: #25637b !important;
            background: repeating-linear-gradient( 135deg, #148cbb , #148cbb 20px, #873ae3 20px, #873ae3 40px );
        }
        .show-types [data-type="smf-os2"] {
            background-color: #7b7d23 !important;
        }
    </style>
    <script type="text/javascript" src="/static/setmode.js" onerror="window.location='/media-failure/?filename=setmode.js'"></script>
    <script>
        initMode()
        document.addEventListener("DOMContentLoaded", e => {
            document.getElementById('typeCheckbox').addEventListener('click', e => {
                let bodyElement = document.getElementsByTagName('body')[0];
                if (e.target.checked) {
                    bodyElement.classList.add('show-types');
                } else {
                    bodyElement.classList.remove('show-types');
                }
            })
        });
    </script>
</head>
<body>
    <header>
        <a href="/">
            <img src="/static/nep_logo.svg" class="sidenav-brand-img logo-light logo" alt="NetBox Logo" height="48">
            <img src="/static/nep_logo_light.svg" class="sidenav-brand-img logo-dark logo" alt="NetBox Logo" height="48">
        </a>
        <a href="/dcim/devices/{{queryset[0].device.id}}">{{queryset[0].device.name}} </a>
        <span>&nbsp;Layout -&nbsp;</span>
        <a href="/dcim/device-types/{{queryset[0].device.device_type.id}}"> {{queryset[0].device.device_type}}</a>
        <span class="manage-link">
            {% if queryset[0].device.primary_ip4 %}
                {% set ip = queryset[0].device.primary_ip4|ip() %}
                <a class="badge bg-green ms-4 link" href="ssh://{{ip}}"><i class="mdi mdi-monitor-lock"></i> SSH <i class="mdi mdi-open-in-new" style="margin-left:0.2em"></i></a>
                <a class="badge bg-green ms-2 link" href="http://{{ip}}" target="_blank"><i class="mdi mdi-cloud-lock"></i> HTTP <i class="mdi mdi-open-in-new" style="margin-left:0.2em"></i></a>
                <a class="badge bg-blue ms-2 link" href="/dcim/devices/{{queryset[0].device.id}}/render-config/?export=True" target="_blank"><i class="mdi mdi-download"></i> Config</a>
            {% endif %}
            <input type="checkbox" class="ms-2" id="typeCheckbox">
            <label for="typeCheckbox">Show Cable/SFP Type</label>
        </span>

    </header>
    <main class="{{switch}}">
        {% for interface in queryset %}
            {% set label = interface.label|replace('/','-') %}
            {% set name = interface.name|replace('(','')|replace(')','') %}
            {% set vlan = 'vlan_' ~ interface.untagged_vlan.vid %}
            {% if interface.mgmt_only == false and interface.is_lag == false and interface.type != "juniper-vcp" %}
                {% if interface.link_peers %}
                    {% set from = interface.link_peers|first %}
                    <section class="switchport {{vlan}} {% for tag in from.device.tags.names() %}{{tag|replace(' ','-') }} {% endfor %}port_{{label}} {{name}}"
                        data-mode="{{interface.type}}"
                        data-cable="{{interface.cable.color}}"
                        data-type="{{interface.cable.type}}">
                        <a class="link-normal" href="/dcim/devices/{{ from.device.id}}" target="_blank"></a>
                        <a class="link-switch" href="/dcim/interfaces/?device_id={{from.device.id}}&export=interface-layouts"></a>
                        <div class="from-cont">
                            <div class="from-name">{{ interface.device}}</div>
                            <div class="from-port">{{ interface.name}}</div>
                            <div class="from-label">{{ interface.label}}</div>
                            <div class="from-type">{{ interface.type}}</div>
                        </div>
                        <div class="to-cont">
                            <div class="to-name">{{ from.device.name}}</div>
                            <div class="to-device">{{ from.device.device_type}}</div>
                            <div class="to-port">{{ from.name}}</div>
                            <div class="to-label">{{ from.label}}</div>
                            <div class="to-type">{{ from.type}}</div>
                        </div>
                        <div class="port-mode">{{ interface.type }}</div>
                        <div class="port-label">{{label|replace(prefix1,'')|replace(prefix2, '')}}</div>
                    </section>
                {% else %}
                    <section class="empty {{vlan}} port_{{label}} {{name}} {% if interface.enabled == false %}disabled{% endif %}" data-mode="{{interface.type}}">
                        <div class="empty-text">
                            {% if interface.enabled == false %}
                                Disabled
                            {% else %}
                                Empty
                            {% endif %}
                            {% if interface.mode == 'access' %}
                                <div class="empty-mode">{{interface.untagged_vlan}}</div>
                            {% elif interface.mode == 'tagged' %}
                                <div class="empty-mode">Trunk</div>
                            {% endif %}
                        </div>
                        <div class="port-label">{{label|replace(prefix1,'')|replace(prefix2, '')}}</div>
                    </section>
                {% endif %}
            {% endif %}
        {% endfor %}
        {% if lanes > 0 %}
            {% for qsfp in range(ports2) %}
                <div class="qsfp-{{qsfp+1}} qsfp"></div>
            {% endfor %}
        {% endif %}
        <div class="blank"></div><div class="blank2"></div>
    </main>
</body>
</html>